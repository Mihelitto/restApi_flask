# Тестовое задание restAPI

Авторизация по логину и паролю. Доступ к сообщениям 

Маршруты:
- /users 
- /login
- /messages


## Запуск

### В Docker

- Клонируйте репозиторий
- Укажите параметры в файле `.env`(см. пункт Переменные окружения)
- Соберите образ командой
```
docker build -t restapi:v1 .
```
- Запустите контейнеры командой
```
docker run -d -p 5000:5000 restapi:v1
```
- Сервер доступен по `127.0.0.1:5000`

### Локально

- Должен быть установлен python3
- Клонируйте репозиторий
- Укажите параметры в файле `.env`(см. пункт Переменные окружения)
- Установите зависимости с помощью `pip` (`pip3` если есть конфликт с python2):
```
pip install -r requirements.txt
```
- Запустите сервер командой:
```
python main.py
```
(или `python3` если есть конфликт с python2)
- Сервер доступен по `127.0.0.1:5000`
- Запуск тестов:
```
pytest test.py
```

## Переменные окружения

Часть настроек проекта берётся из переменных окружения. Чтобы их определить, создайте файл `.env` в корневой папке и запишите туда данные в таком формате: `ПЕРЕМЕННАЯ=значение`.  За основу можно взять файл `env_example`, заменить значения переменных на свои и переименовать его в `.env`.
- `SECRET_KEY` - ключ шифрования токена
- `DATABASE_URI` - URI БД, по умолчанию `'sqlite:///db.sqlite3?check_same_thread=False'`

## Использование

Доступные endpoint'ы

- GET, POST http://127.0.0.1:5000/users не требует аутентификации, 
можно просмотреть существующих пользователей в БД и добавить нового.
Формат для добавления `{'name': 'Name', 'password': '123'}`
- POST http://127.0.0.1:5000/login для аутентификации и получения токена,
формат сообщения `{'name': 'Name', 'password': '123'}`
- POST http://127.0.0.1:5000/messages требует аутентификации(token)
token указывается в заголовке запроса
```
{'Authorization': 'bearer aUzI1NiJ9.eyJuYW1lIjoibmFtZSJ9.Q1CzxnZeZ7Ba9p8GIkRmNHK4jCssJKWk1XI'}
```
Два возможных формата сообщения:
- `{'name': 'Name', 'message': 'history 10'}` - вернёт 10 последних сообщений
- `{'name': 'Name', 'message': 'some text'}` - добавит сообщение в базу
